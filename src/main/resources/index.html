<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="style.css" />
    <script data-require="jquery@*" data-semver="3.1.1" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <style>
        #container {border: 1px solid brown;}
        H1 {float: left;}

        .button{
            background-color:#55A;
            border: 1px solid #229;
            width: 100px;
            float: right;
            font-size: 2em;
            color: white;
            text-align: center;
        }
        #cancelButton{
            border-radius: 8px;
            background-color: grey;
        }
        #acceptButton{
            border-radius: 8px;
            background-color: red;
        }
        #receiptList {
            border: 1px solid green;
            clear: both;
        }

        .receipt {
            background-color: #eee;
            margin-bottom: 5px;
        }
    </style>
    <script>
        // This is the idiomatic way to ensure that JQuery does not
        // execute until the page has loaded
        $(function(){
            const api = "http://localhost:8080"; // <- do not need a root api URL if this page is served directly by the API

            $.getJSON(api+"/receipts", function(receipts){
              var items = [];
              $.each( receipts, function( key, val ) {
                items.push( "<div id='" + key + "'>" + val.created + "</div>" );
                items.push( "<div id='" + key + "'>" + val.merchantName + "</div>" );
                items.push( "<div id='" + key + "'>" + val.value + "</div>" );
                items.push( "<div id='" + key + "'>" + val.tags + "</div>" );
              $( "<div/>", {
                "class": "receipt-List",
                html: items.join( "" )
              }).appendTo( $("#receiptList") );
            })
        })
        $("#receiptButton").bind("click",function(){
          $(".inputPanel").show();
        });
        $("#cancelButton").bind("click",function(){
          $("input[type=text], textarea").val("");
          $(".inputPanel").hide();
        })

        $("#acceptButton").click(function saveReceipt(){
          var merchant = $("#merchantName").val();
          var amount = $("#value").val();
          alert(amount);
          item = {}
          item ["\"merchant\""] = merchant;
          item ["\"amount\""] = parseInt(amount);
          console.log(item);
          $.ajax({
            beforeSend: function(xhrObj){
                xhrObj.setRequestHeader("Content-Type","application/json");
                xhrObj.setRequestHeader("Accept","application/json");
            },
            type: "POST",
            url: api+"/receipts",
            data: JSON.stringify(item),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(data){alert(data);},
            failure: function(errMsg) {
              alert(errMsg);
            }
          })
        })
      })
    </script>
</head>

<body>
<DIV id="container">
    <h1>My receipts</h1>
    <div class="button" id="receiptButton">+</div>
    <div class="inputPanel" style="display:none">
      <input type="text" id="merchantName" class="receiptPanel" name="Merchant" value="">
      <input type="text" id="value" class="receiptPanel" name="Amount" value="">
      <div class="button receiptButton reset" id="cancelButton">+</div>
      <div class="button receiptButton" id="acceptButton">+</div>
    </div>
    <div id="receiptList">
      <div>Time</div>
      <div>Merchant</div>
      <div>$</div>
      <div>Tag</div>
    </div>
</DIV>
</body>

</html>
